<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="list.html">
<link rel="import" href="greeting.html">
<link rel="import" href="scoreboard.html">
<link rel="import" href="x-websocket.html">

<polymer-element name="monicore-app">
  <template>
    <core-header-panel>
      <core-toolbar>
        <paper-tabs id="tabs" selected="{{show}}" self-end>
          <paper-tab name="welcome">Welcome</paper-tab>
          <paper-tab name="hockey">Hockey</paper-tab>
        </paper-tabs>
      </core-toolbar>
      <x-websocket url="ws://192.171.0.120:3001/websocket" json response="{{websocketResponse}}"></x-websocket>
      <core-ajax url="//192.171.0.120:3001/wsSendJSON"></core-ajax>
      <div class="container">
        <div id="welcome" class="content hero-unit" hidden?="{{show != 'welcome'}}" layout vertical center>
          <polymer-greeting></polymer-greeting>
          <p>{{show}}, You now have</p>
          <paper-checkbox style="margin:20px;"></paper-checkbox>
          <paper-fab mini icon="favorite" on-click="{{toastFromButton}}"></paper-fab>
          <polymer-list></polymer-list>
        </div>
        <div id="hockey" class="content" hidden?="{{show != 'hockey'}}">
          <polymer-scoreboard listData="{{hockeyResponse}}" event="NHL"></polymer-scoreboard>
        </div>
      </div>
      <paper-toast id="toast" text="Your page has been loaded."></paper-toast>
    </core-header-panel>
    <!-- build:css styles/main.css -->
    <link rel="stylesheet" href="../styles/main.css">
    <!-- endbuild-->
  </template>
  <script>
    Polymer({
      toastFromButton: function(e, detail, sender) {
        var ajax = document.querySelector('monicore-app::shadow core-ajax');
        ajax.go();
        var toast = document.querySelector('monicore-app::shadow #toast');
        if(!toast.opened){
          toast.attributes["text"].nodeValue = "Hockey tab have been loaded!";
          toast.show();
        }
      },
      ready: function() {
        var listCurrentApi = ['hockey','twitter'];
        var xwebsocket = this.shadowRoot.querySelector('x-websocket');
        xwebsocket.addEventListener('open', function(e) {
          xwebsocket.send(listCurrentApi);
        });

        this.websocketResponse = null;
        this.hockeyResponse = null;
        this.show = 'welcome';
        var tabs = document.querySelector('monicore-app::shadow paper-tabs');
        var hockey = document.querySelector('monicore-app::shadow polymer-scoreboard');

        tabs.addEventListener('core-select', this.tabsEventListener);
        document.querySelector('monicore-app::shadow #toast').show();
      },
      websocketResponseChanged: function() {
        switch(this.websocketResponse.type) {
          case "hockey":
            this.hockeyResponse = this.websocketResponse.data;
            break;
          case "twitter":
            break;
          default:
            break;
        }
      },
      tabsEventListener: function(){
        var hockey = document.querySelector('monicore-app::shadow polymer-scoreboard');
        if(this.selected == 'hockey'){
          hockey.event = 'NHL';
        }else{
          hockey.event = 'all';
        }
      }  
    });
  </script>
</polymer-element>
